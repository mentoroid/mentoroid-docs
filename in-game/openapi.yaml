openapi: 3.0.3
info:
  title: Mentoroid In-Game Coaching API
  version: 2.0.0
  description: |
    ## Overview
    | Service | Port | Purpose |
    |---------|------|---------|
    | Coaching Backend | 39144 | Pipeline control, player setup |
    | GSI Handler | 19151 | Dota 2 Game State Integration |
    | Match Events | 18100 | Flutter implements this server |

    ## Flutter Integration Flow
    1. GET /ready - Check backend running
    2. GET /player_info - Check if Steam ID set
    3. POST /set_player - Set Steam ID
    4. Done - auto-detection handles rest

    ## Auto-Detection
    Watcher auto-starts/stops pipeline when Dota 2 opens/closes.
    No need to call /start or /stop manually.

    ## Flutter Server (port 18100)
    Flutter must implement POST /match_started and POST /match_end

    ## GSI Setup (Windows)

    ### Step 1: Create config folder
    Navigate to your Dota 2 cfg folder and create the GSI folder:
    ```
    C:\Program Files (x86)\Steam\steamapps\common\dota 2 beta\game\dota\cfg\gamestate_integration\
    ```

    ### Step 2: Create config file
    Inside gamestate_integration folder, create `gamestate_integration_mentoroid.cfg`:
    ```
    "Dota 2 Integration Configuration"
    {
        "uri"          "http://localhost:19151/"
        "timeout"      "5.0"
        "buffer"       "0.1"
        "throttle"     "0.1"
        "heartbeat"    "10.0"
        "data"
        {
            "auth"            "mentoroid_gsi"
            "provider"        "1"
            "map"             "1"
            "player"          "1"
            "hero"            "1"
            "abilities"       "1"
            "items"           "1"
            "events"          "1"
            "buildings"       "1"
            "league"          "1"
            "draft"           "1"
            "wearables"       "1"
            "minimap"         "1"
            "roshan"          "1"
            "couriers"        "1"
            "neutralitems"    "1"
        }
    }
    ```

    ### Step 3: Enable in Dota 2
    In Dota 2: Settings -> Social -> Enable "Share match data with third-party sources"

servers:
  - url: http://localhost:39144
    description: Coaching Backend
  - url: http://localhost:18100
    description: Match Events (Flutter Server)
  - url: http://localhost:19151
    description: GSI Handler

tags:
  - name: Player Setup
  - name: Status
  - name: Pipeline Control
  - name: Match Events (Flutter Server)

paths:
  /set_player:
    post:
      tags: [Player Setup]
      summary: Set Steam ID
      requestBody:
        content:
          application/json:
            example: {steam_id: "76561197960272226"}
      responses:
        "200":
          content:
            application/json:
              example: {status: success, player_name: Wile}

  /player_info:
    get:
      tags: [Player Setup]
      summary: Get player info
      responses:
        "200":
          content:
            application/json:
              example: {status: success, steam_id: "76561197960272226"}

  /ready:
    get:
      tags: [Status]
      summary: Check backend ready
      responses:
        "200":
          content:
            application/json:
              example: {ready: true, running: false}

  /watcher_status:
    get:
      tags: [Status]
      summary: Get watcher status
      responses:
        "200":
          content:
            application/json:
              example: {watcher_running: true, dota_detected: true}

  /start:
    post:
      tags: [Pipeline Control]
      summary: Manual start (optional - watcher auto-starts)
      responses:
        "200":
          content:
            application/json:
              example: {status: started}

  /stop:
    post:
      tags: [Pipeline Control]
      summary: Manual stop (optional - watcher auto-stops)
      responses:
        "200":
          content:
            application/json:
              example: {status: stopped}

  /volume_set:
    post:
      tags: [Pipeline Control]
      summary: Set TTS volume
      requestBody:
        content:
          application/json:
            example: {volume: 75}
      responses:
        "200":
          content:
            application/json:
              example: {status: success, volume: 75}

  /volume_get:
    get:
      tags: [Pipeline Control]
      summary: Get TTS volume
      responses:
        "200":
          content:
            application/json:
              example: {status: success, volume: 75}

  /match_started:
    post:
      tags: [Match Events (Flutter Server)]
      summary: Match started webhook (Flutter implements)
      requestBody:
        content:
          application/json:
            example: {match_id: "8648059066"}
      responses:
        "200":
          content:
            application/json:
              example: {status: ok}

  /match_end:
    post:
      tags: [Match Events (Flutter Server)]
      summary: Match ended webhook (Flutter implements)
      requestBody:
        content:
          application/json:
            example:
              match_id: "8648059066"
              session_data:
                hero_id: 35
                Win: Win
                role: Support
                game_time: 553
                networth: 20491
                kill: 0
                death: 0
                assist: 0
      responses:
        "200":
          content:
            application/json:
              example: {status: ok}
